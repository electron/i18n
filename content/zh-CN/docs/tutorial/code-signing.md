# ä»£ç ç­¾å

ä»£ç ç­¾åæ˜¯ä¸€ç§ç”¨æ¥è¯æ˜åº”ç”¨æ˜¯ç”±ä½ åˆ›å»ºçš„ä¸€ç§å®‰å…¨æŠ€æœ¯ã€‚

macOS ç³»ç»Ÿèƒ½é€šè¿‡ä»£ç ç­¾åæ£€æµ‹å¯¹appçš„ä»»ä½•ä¿®æ”¹ï¼ŒåŒ…æ‹¬æ„å¤–ä¿®æ”¹å’Œæ¥è‡ªæ¶æ„ä»£ç çš„ä¿®æ”¹ã€‚

åœ¨Windowsä¸Šï¼Œç³»ç»Ÿç»™æ‚¨çš„ä»£ç ç­¾åè¯ä¹¦ æŒ‡å®šä¿¡ä»»ç­‰çº§ï¼Œå¦‚æœæ‚¨æ²¡æœ‰ï¼Œåˆ™ç»™æ‚¨æŒ‡å®šä¿¡ä»»ç­‰çº§ã€‚ æˆ–è€…å¦‚æœæ‚¨çš„ä¿¡ä»»ç­‰çº§å¾ˆä½ï¼Œåœ¨ç”¨æˆ·å¼€å§‹ä½¿ç”¨æ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå°†å¯¼è‡´å‡ºç°å®‰å…¨ å¯¹è¯æ¡†ã€‚  ä¿¡ä»»çº§åˆ«éšç€æ—¶é—´çš„æ¨ç§»æ„å»ºï¼Œå› æ­¤æœ€å¥½å°½æ—©å¼€å§‹ä»£ç ç­¾åã€‚

å³ä½¿å¼€å‘è€…å¯ä»¥å‘å¸ƒä¸€ä¸ªæœªç­¾åçš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å»ºè®®è¿™æ ·åšã€‚ Windows å’Œ macOS é»˜è®¤éƒ½ä¼šé˜»æ­¢ä¸‹è½½æˆ–æ‰§è¡Œ æœªç­¾ååº”ç”¨ç¨‹åºã€‚ ä» macOS Catalina (ç‰ˆæœ¬ 10.15) å¼€å§‹ï¼Œç”¨æˆ· å¿…é¡»ç»è¿‡å¤šä¸ªæ‰‹åŠ¨æ­¥éª¤æ‰èƒ½æ‰“å¼€æœªç­¾åçš„åº”ç”¨ç¨‹åºã€‚

![macOS Catalina Gatekeeper è­¦å‘Šï¼šæ— æ³•æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå¼€å‘è€…æ— æ³•éªŒè¯](../images/gatekeeper.png)

å¦‚ä½ æ‰€è§ï¼Œç”¨æˆ·æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šç›´æ¥åˆ é™¤åº”ç”¨æˆ–è€…å–æ¶ˆè¿è¡Œã€‚ ä½ ä¸ä¼šæƒ³è®©ç”¨æˆ·çœ‹è§è¯¥å¯¹è¯æ¡†ã€‚

å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€æ¬¾Electronåº”ç”¨ï¼Œå¹¶æ‰“ç®—å°†å…¶æ‰“åŒ…å‘å¸ƒï¼Œé‚£ä½ å°±åº”è¯¥ä¸ºå…¶æ·»åŠ ä»£ç ç­¾åã€‚

# ç­¾å & è®¤è¯ macOS ç‰ˆæœ¬

æ­£ç¡®å‡†å¤‡ macOS åº”ç”¨ç¨‹åºçš„å‘å¸ƒéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆï¼Œåº”ç”¨ç¨‹åºéœ€è¦ç­¾åã€‚ ç„¶åï¼Œåº”ç”¨ç¨‹åºéœ€è¦ä¸Šä¼ åˆ°è‹¹æœï¼Œç„¶åæ‰èƒ½è¿›è¡Œåä¸ºâ€œå…¬è¯â€çš„è¿‡ç¨‹ï¼Œ è‡ªåŠ¨åŒ–ç³»ç»Ÿå°†ä¼šè¿›ä¸€æ­¥éªŒè¯æ‚¨çš„åº”ç”¨æ²¡æœ‰åšä»»ä½•äº‹æƒ…æ¥å±åŠå…¶ç”¨æˆ·ã€‚

è‹¥è¦å¯åŠ¨è¿›ç¨‹ï¼Œè¯·ç¡®ä¿æ‚¨æ»¡è¶³ç­¾åè¦æ±‚å¹¶ è®¤è¯æ‚¨çš„åº”ç”¨ï¼š

1. åŠ å…¥ [Apple Developer Program][](éœ€è¦ç¼´çº³å¹´è´¹)
2. ä¸‹è½½å¹¶å®‰è£… [Xcode][] - è¿™éœ€è¦è¿è¡ŒmacOS çš„è®¡ç®—æœºã€‚
3. ç”Ÿæˆï¼Œä¸‹è½½ï¼Œç„¶åå®‰è£…[ç­¾åè¯ä¹¦ï¼ˆsigning certificatesï¼‰][]

Electron çš„ç”Ÿæ€ç³»ç»Ÿæœ‰åˆ©äºé…ç½®å’Œè‡ªç”±ï¼Œæ‰€ä»¥æœ‰å¤šç§æ–¹æ³•è®©æ‚¨çš„åº”ç”¨ç¨‹åºç­¾åå’Œå…¬è¯ã€‚

## `electron-forge`

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Electron çš„æœ€å–œæ¬¢çš„æ„å»ºå·¥å…·ï¼Œè®©æ‚¨çš„åº”ç”¨ç¨‹åºç­¾å å¹¶ç»è¿‡å…¬è¯éœ€è¦å¯¹æ‚¨çš„é…ç½®è¿›è¡Œä¸€äº›æ·»åŠ ã€‚ [Forge](https://electronforge.io) æ˜¯å®˜æ–¹çš„ Electron å·¥å…·çš„ é›†åˆï¼Œåœ¨hoodä¸‹ä½¿ç”¨ [`electron-packager`][] [`electron-osx-sign`][] [`electron-notarize`][] ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªæ‰€æœ‰å¿…éœ€å­—æ®µçš„ç¤ºä¾‹é…ç½®ã€‚ å¹¶ä¸æ˜¯æ‰€æœ‰éƒ½æ˜¯å¿…éœ€çš„ï¼šå·¥å…·éå¸¸èªæ˜è¶³ä»¥è‡ªåŠ¨æ‰¾åˆ°åˆé€‚çš„ `identity`, ä¾‹å¦‚ï¼Œä½†æˆ‘ä»¬å»ºè®®ä½ æ˜ç™½æ— è¯¯ã€‚

```json
{
  "name": "my-app",
  "version": "0.0.1",
  "config": {
    "forge": {
      "packagerConfig": {
        "osxSign": {
          "identity": "Developer ID Application: Felix Rieseberg (LT94ZKYDCJ)",
          "hardened-runtime": true,
          "entitlements": "entitlements.plist",
          "entitlements-inherit": "entitlements.plist",
          "signature-flags": "library"
        },
        "osxNotarize": {
          "appleId": "felix@felix.fun",
          "appleIdPassword": "my-apple-id-password",
        }
      }
    }
  }
}
```

æ­¤å¤„å¼•ç”¨çš„ `plist` æ–‡ä»¶éœ€è¦ä»¥ä¸‹çš„ macOS ç‰¹å®šæƒé™æ¥ä¿è¯æ‚¨çš„åº”ç”¨æ­£åœ¨åšè¿™äº›äº‹æƒ…çš„è‹¹æœå®‰å…¨æœºåˆ¶å¹¶ä¸æ„å‘³ç€ä»»ä½•ä¼¤å®³ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple/DTD PLIST 1.0//EN" "http://www. ple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>com.apple.security.cs. llowjit</key>
    <true/>
    <key>com.apple.security.cs. llow-unsigned-executable-memory</key>
    <true/>
    <key>comã€‚ ple.cs.debugger</key>
    <true/>
  </dict>
</plist>
```

è¦æŸ¥çœ‹æ‰€æœ‰è¿™äº›éƒ½åœ¨æ“ä½œä¸­ï¼Œè¯·æŸ¥çœ‹ Electron Fiddle çš„æºä»£ç ï¼Œ[å°¤å…¶æ˜¯å…¶ `electron-forge` é…ç½®æ–‡ä»¶](https://github.com/electron/fiddle/blob/master/forge.config.js)ã€‚

å¦‚æœæ‚¨æ‰“ç®—åœ¨åº”ç”¨ä¸­ä½¿ç”¨ Electron çš„ API è®¿é—®éº¦å…‹é£æˆ–æ‘„åƒå¤´ï¼Œæ‚¨è¿˜éœ€è¦æ·»åŠ ä»¥ä¸‹æƒé™ï¼š

```xml
<key>com.apple.security.device.audio-input</key>
<true/>
<key>com.apple.security.device.camp</key>
<true/>
```

å¦‚æœæ‚¨ä½¿ç”¨æ—¶æ‚¨çš„åº”ç”¨åº”äº«å¾…é‡ä¸­ä¸å­˜åœ¨è¿™äº›å†…å®¹ï¼Œä¾‹å¦‚ï¼š

```js
const { systemPreferences } = require('electron')

const microphone = systemPreference.askForMediaAccess('microphone')
```

æ‚¨çš„åº”ç”¨å¯èƒ½ä¼šå´©æºƒã€‚ åœ¨ [Hardened Runtime](https://developer.apple.com/documentation/security/hardened_runtime) ä¸­æŸ¥çœ‹èµ„æºè®¿é—®éƒ¨åˆ†ä»¥è·å–æ›´å¤šä¿¡æ¯å’Œæ‚¨å¯èƒ½éœ€è¦çš„æƒé™ã€‚

## `electron-builder`

Electron Builder å¸¦æœ‰ä¸€ä¸ªè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆç”¨äºç­¾ç½²æ‚¨çš„åº”ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° [å®ƒçš„æ–‡æ¡£](https://www.electron.build/code-signing)

## `electron-packager`

å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨åƒForgeæˆ–Builderè¿™æ ·çš„é›†æˆæ„å»ºæ°´é“ï¼Œ æ‚¨ å¯èƒ½ä½¿ç”¨ [`electron-packer`][]å…¶ä¸­åŒ…æ‹¬ [`electron-osx-signe`][] [`electron-å…¬è¯`][].

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨Packagerçš„ APIï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½® [æ¥ç­¾åå¹¶å¯¹æ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œå…¬è¯](https://electron.github.io/electron-packager/master/interfaces/electronpackager.options.html)

```js
const packer = require('electron-packer')

packer(
  dir: '/path/to/my/app',
  osxSign: v.
    identity: 'Developer ID Application: Felix Rieseberg (LT94ZKYDCJ)',
    'ç¡¬è¿è¡Œæ—¶é—´'ï¼štrueï¼Œ
    åº”äº«æƒåˆ©: 'åº”äº«æƒåˆ©ã€‚ list',
    'åº”äº«æƒåˆ©-ç»§æ‰¿': 'åº”äº«æƒåˆ©ã€‚ list',
    'signature-flags': 'library'
  },
  osxNotarize: }
    appleId: 'felix@felix. un',
    AppleIdPassword: 'my-apple-id-password'
  }
})
```

æ­¤å¤„å¼•ç”¨çš„ `plist` æ–‡ä»¶éœ€è¦ä»¥ä¸‹çš„ macOS ç‰¹å®šæƒé™æ¥ä¿è¯æ‚¨çš„åº”ç”¨æ­£åœ¨åšè¿™äº›äº‹æƒ…çš„è‹¹æœå®‰å…¨æœºåˆ¶å¹¶ä¸æ„å‘³ç€ä»»ä½•ä¼¤å®³ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple/DTD PLIST 1.0//EN" "http://www. ple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>com.apple.security.cs. llowjit</key>
    <true/>
    <key>com.apple.security.cs. llow-unsigned-executable-memory</key>
    <true/>
    <key>comã€‚ ple.cs.debugger</key>
    <true/>
  </dict>
</plist>
```

## Mac App Store

See the [Mac App Store Guide][].

# ç­¾ç½²windowsåº”ç”¨ç¨‹åº

åœ¨ç­¾ç½²Windowsåº”ç”¨ç¨‹åºå‰ï¼Œä½ éœ€è¦å®Œæˆä»¥ä¸‹äº‹é¡¹ï¼š

1. è·å–ä¸€ä¸ª Windows èº«ä»½éªŒè¯ç ç­¾åè¯ä¹¦ (éœ€è¦å¹´åº¦è´¹ç”¨)
2. å®‰è£… Visual Studio ä»¥è·å–ç­¾åå·¥å…· (å…è´¹ [ç¤¾åŒºç‰ˆ](https://visualstudio.microsoft.com/vs/community/) å·²è¶³å¤Ÿ)

æ‚¨å¯ä»¥ä»è®¸å¤šè½¬å”®å•†è·å¾—ä»£ç ç­¾åè¯ä¹¦ã€‚ ä»·æ ¼å„å¼‚ï¼Œæ‰€ä»¥å€¼å¾—ä½ èŠ±ç‚¹æ—¶é—´å»è´§æ¯”ä¸‰å®¶ã€‚ çƒ­é—¨è½¬é”€å•†åŒ…æ‹¬ï¼š

* [digicert](https://www.digicert.com/code-signing/microsoft-authenticode.htm)
* [Sectigo](https://sectigo.com/ssl-certificates-tls/code-signing)
* [GoDaddy](https://au.godaddy.com/web-security/code-signing-certificate)
* é™¤å…¶ä»–å¤–ï¼Œè¯·è´§æ¯”ä¸‰å®¶åé€‰æ‹©é€‚åˆä½ çš„é‚£ä¸€æ¬¾ï¼ŒGoogle æ˜¯æ‚¨çš„æœ‹å‹ğŸ˜„ï¼š

ä½ å¯ä»¥è¿ç”¨è®¸å¤šæ–¹å¼æ¥ç­¾ç½²ä½ çš„åº”ç”¨ï¼š

* [`electron-winstaller`][] å°†ä¸ºçª—å£ç”Ÿæˆä¸€ä¸ªå®‰è£…ç¨‹åºå¹¶ä¸ºæ‚¨ç­¾å
* [`electron-forge`][] å¯ä»¥ç­¾ç½²å®ƒé€šè¿‡ Squirel.Windows æˆ– MSIç›®æ ‡ç”Ÿæˆçš„å®‰è£…ç¨‹åºã€‚
* [`electron-builder`][] can sign some of its windows targets

## Windows Store

å‚è€ƒ [Windows Store Guide][].

[Apple Developer Program]: https://developer.apple.com/programs/
[`electron-builder`]: https://github.com/electron-userland/electron-builder
[`electron-forge`]: https://github.com/electron-userland/electron-forge
[`electron-osx-sign`]: https://github.com/electron-userland/electron-osx-sign
[`electron-osx-signe`]: https://github.com/electron-userland/electron-osx-sign
[`electron-packager`]: https://github.com/electron/electron-packager
[`electron-packer`]: https://github.com/electron/electron-packager
[`electron-notarize`]: https://github.com/electron/electron-notarize
[`electron-å…¬è¯`]: https://github.com/electron/electron-notarize
[`electron-winstaller`]: https://github.com/electron/windows-installer
[Xcode]: https://developer.apple.com/xcode
[ç­¾åè¯ä¹¦ï¼ˆsigning certificatesï¼‰]: https://github.com/electron/electron-osx-sign/wiki/1.-Getting-Started#certificates
[Mac App Store Guide]: mac-app-store-submission-guide.md
[Windows Store Guide]: windows-store-guide.md
