# Архитектура приложения Electron

Перед погружением в API нужно обсудить два доступных в Electron типа процессов. Они фундаментально различаются и их важно понимать.

## Основной( Main ) и графический( Renderer ) процессы

В Electron процесс, который запускает `package.json` `main` сценарий называется __основной процесс__. Скрипт, запущенный в основном процессе может отображать GUI путём создания веб-страниц. В приложениях Electron всегда есть один главный процесс, но не больше.

Так как Electron использует Chromium для отображения веб-страниц, то используется мульти-процессорная архитектура Chromium. Каждая веб-страница электрон выполняется в собственном процессе, который называют __процесс визуализации__.

В нормальных браузерах, веб-страницы обычно выполняются в изолированной среде и им не разрешается доступ к нативным ресурсам. Пользователи Electron'а, однако, имеют право использовать API Node.js на веб-страницах, позволяя взаимодействовать на низком уровне операционной системы.

### Различия между основными процессами и процессами визуализации

Основной процесс создает веб-страницы путем создания экземпляров `BrowserWindow`. Каждый экземпляр `BrowserWindow` запускает веб-страницу в процессе визуализации. Когда экземпляр `BrowserWindow` уничтожается, соответствующий процесс визуализации также прекращается.

Основной процесс управляет всеми веб-страницами и процессами их визуализации. Каждый процесс визуализации изолирован и заботится только о веб-странице, работающей в нем.

В веб-страницах вызов интерфейсов API нативного GUI запрещён, поскольку управление ресурсами нативного GUI на веб-страницах довольно опасно и может вызвать утечку ресурсов. Если вы хотите выполнить GUI операции на веб-странице, процесс визуализации веб-страницы должен общаться с основным процессом для запроса выполнения этих операций основного процесса.

> #### Примечание: взаимодействие между процессами
> 
> В Electron у нас есть несколько способов связи между основным процессом и процессом визуализации, такие как [` ipcRenderer `](../api/ipc-renderer.md) и [` ipcMain `](../api/ipc-main.md) для отправки сообщений, а также [remote](../api/remote.md) модуль для связи в стиле RPC. Так же доступен FAQ о [том, как обмениваться данными между веб-страницами][share-data].

## Использование API Electron

В Electron доступен ряд API-интерфейсов, поддерживающих разработку настольных приложений в обоих процессах - основном процессе и процессе визуализации. Для доступа к API Electron вам необходимо включить в проект в каждом процессе следующий модуль:

```javascript
const electron = require('electron')
```

Все API-интерфейсы назначаются типам процессов. Многие из них могут использоваться только из основного процесса, некоторые только из процесса визуализации, а какие-то - из обоих процессов. В документации для каждого отдельного API указывается, для какого типа процесса он может быть использован.

Например, окно в Electron создается с использованием класса `BrowserWindow`. Он доступен только в основном процессе.

```javascript
// Это сработает только в основном процессе,
// в процессе визуализации же будет undefined
const { BrowserWindow } = require('electron')

const win = new BrowserWindow()
```

Поскольку возможна связь между процессами, процесс визуализации может вызвать основной процесс для выполнения задач. Electron имеет модуль, называемый `remote`, который предоставляет API, доступный только основному процессу. Чтобы создать `BrowserWindow` из процесса визуализации, мы используем remote в качестве посредника:

```javascript
// Это сработает в процессе визуализации, но будет undefined
// в основном процессе
const { remote } = require('electron')
const { BrowserWindow } = remote

const win = new BrowserWindow()
```

## Использование API Node.js

Electron предоставляет полный доступ к Node.js из обоих типов процессов. Это имеет два важных следствия:

1) Все API, доступные в Node.js также доступны и в Electron. Выполните следующий код в приложении Electron:

```javascript
const fs = require('fs')

const root = fs.readdirSync('/')

// Выведет все файлы на корневом уровне диска,
// либо '/' либо 'C:\'.
console.log(root)
```

Как вы уже могли догадаться, попытка загрузить удаленный контент серьезно повлияет на безопасность. Вы можете найти дополнительную информацию и руководство по загрузке удаленного контента в нашей [документации по безопасности][security].

2) Вы можете использовать Node.js модули в вашем приложении. Выберите свой любимый npm модуль. В настоящее время npm предлагает крупнейшее в мире хранилище open-source кода – возможность использовать хорошо поддерживаемый и протестированный код, который ранее был уделом лишь серверных приложений, является одной из ключевых особенностей Electron.

Например чтобы использовать официальный AWS SDK в вашем приложении, следует сначала установить его как зависимость:

```sh
npm install --save aws-sdk
```

Затем в вашем приложении Electron, подключите и используйте модуль, так же как в Node.js приложении:

```javascript
// Готовый к использованию S3 Client
const S3 = require('aws-sdk/clients/s3')
```

Существует одна важная оговорка: нативные Node.js модули (то есть модули, которые требуют компиляции собственного кода, прежде чем они могут быть использованы) должны быть скомпилированы для использования с Electron.

Подавляющее большинство модулей Node.js _не являются_ нативными. Только 400 из более, чем 650 тысяч модулей являются нативными. Однако, если вам всё же требуются нативные модули, обратитесь к [документации, как скомпилировать их для использования в Electron][native-node].

[security]: ./security.md
[native-node]: ./using-native-node-modules.md
[share-data]: ../faq.md#how-to-share-data-between-web-pages
