# Тестирование с помощью систем непрерывной интеграции (Travis, Jenkins)

Для работы на основе Chromium, Electron требуется драйвер дисплея. Если Chromium не может найти драйвер дисплея, Electron не сможет запустить - и, следовательно, не выполнит ни одного из ваших тестов, независимо от того, как вы работаете их. Тестирование приложений на базе Electron на Travis, Circle, Jenkins или подобных системах требует небольшой конфигурации. По сути, нам нужно использовать виртуального дисплея.

## Настройка виртуального дисплея

Сначала установите [Xvfb](https://en.wikipedia.org/wiki/Xvfb). Это виртуальный кадровый буфер, реализующий серверный протокол отображения X11 - он выполняет все графические операции в памяти без показа любого экрана, это именно то, что нам нужно.

Затем создайте виртуальный экран Xvfb и экспортируйте переменную окружения, называемую DISPLAY, которая указывает на него. Chromium в Electron будет автоматически искать к `$DISPLAY`, поэтому дальнейшая настройка приложения не требуется. Этот шаг может быть автоматизирован с помощью Anai<unk> s Betts' [xvfb-Может быть](https://github.com/anaisbetts/xvfb-maybe): Подготовьте ваши команды с `xvfb-может быть` и маленький инструмент автоматически настроет Xvfb, при необходимости текущей системой. На Windows или macOS, он не будет ничего делать.

```sh
## В Windows или macOS это вызывает electron-mocha
## в Linux, если мы находимся в безголовной среде, то это будет эквивалентно
## xvfb-run electron-mocha . test/*.js
xvfb-maybe electron-mocha ./test/*.js
```

### Travis CI

Для Travis, ваш `.travis.yml` должен выглядеть примерно так:

```yml
addons:
  apt:
    packages:
      - xvfb

install:
  - export DISPLAY=':99.0'
  - Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
```

### Jenkins

Для Jenkins доступен [плагин Xvfb](https://wiki.jenkins-ci.org/display/JENKINS/Xvfb+Plugin).

### Circle CI

Circle CI замечательный, так что xvfb и `$DISPLAY` [уже установлены, и дополнительной настройки не требуется](https://circleci.com/docs/environment#browsers).

### AppVeyor

AppVeyor работает под Windows, поддерживает Selenium, Chromium, Electron и другие подобные инструменты "из коробки" - настройка не требуется.
