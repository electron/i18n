# crashReporter

> Отправляйте отчёты об ошибках на удалённый сервер.

Процессы: [Основной](../glossary.md#main-process), [Графический](../glossary.md#renderer-process)

Ниже приводится пример настройки Electron для автоматического отправки отчетов о сбоях на удаленный сервер:

```javascript
const { crashReporter } и требуют ('электрон')

crashReporter.start (я submitURL: 'https://your-domain.com/url-to-submit' )
```

Чтобы настроить сервер для приёма и обработки отчётов об ошибках, вы можете использовать эти проекты:

* [socorro](https://github.com/mozilla/socorro)
* [mini-breakpad-server](https://github.com/electron/mini-breakpad-server)

Или используйте стороннее решение:

* [Backtrace](https://backtrace.io/electron/)
* [Sentry](https://docs.sentry.io/clients/electron)
* [BugSplat](https://www.bugsplat.com/docs/platforms/electron)

Отчеты о сбоях хранятся временно перед загрузкой в каталог под каталогом пользовательских данных приложения (так называемый 'Crashpad' на Windows и Mac, или 'Crash Reports' на Linux). Вы можете переопределить этот каталог, позвонив `app.setPath('crashDumps', '/path/to/crashes')` перед началом аварии репортером.

На Windows и macOS Electron использует [аварийной панели](https://chromium.googlesource.com/crashpad/crashpad/+/master/README.md) для мониторинга и сообщения о сбоях. На Linux Electron использует [breakpad](https://chromium.googlesource.com/breakpad/breakpad/+/master/). Это является деталью реализации, движимой Хромом, и она может измениться в будущем. В частности, crashpad новее и, скорее всего, в конечном итоге заменить всех платформах.

### Примечание о детских процессах узла на Linux

Если вы используете модуль Node.js `child_process` и хотите сообщить о сбоях от этих процессов на Linux, есть дополнительный шаг, который вам нужно будет сделать, чтобы должным образом инициализировать репортер аварии в процессе ребенка. Это не обязательно Mac или Windows, так как эти платформы используют Crashpad, который автоматически контролирует детские процессы.

Поскольку `require('electron')` не доступен в процессах детей узла, следующие API доступны на объекте `process` в процессах детей узла. Обратите внимание, что на Linux, каждый процесс ребенка узла имеет свой собственный отдельный репортер аварии лома. Это отличается от процессов детей-рендеров, имеют "заглушку" брейкпад репортер, который возвращает информацию в основной для отчетности.

#### `process.crashReporter.start(options)`

Смотрите [`crashReporter.start()`](#crashreporterstartoptions).

#### `process.crashReporter.getParameters()`

Смотрите [`crashReporter.getParameters()`](#crashreportergetparameters).

#### `process.crashReporter.addExtraParameter (ключ, значение)`

Смотрите [`crashReporter.addExtraParameter(key, value)`](#crashreporteraddextraparameterkey-value).

#### `process.crashReporter.removeExtraParameter (ключ)`

Смотрите [`crashReporter.removeExtraParameter(key)`](#crashreporterremoveextraparameterkey).

## Методы

Модуль `crashReporter` имеет следующие методы:

### `crashReporter.start(options)`

* `options` Object
  * `submitURL` String - URL, на который будет отправлен отчет POST-запросом.
  * `productName` String (опционально) - Значение по умолчанию - `app.name`.
  * `companyName` Строка (по желанию) _Deprecated_ - Deprecated псевдоним для `{ globalExtra: { _companyName: ... } }`.
  * `uploadToServer` Boolean (по желанию) - Следует ли отправить отчеты о на сервер. Если ложные сообщения о сбоях будут собраны и сохранены в каталоге , но не загружены. По умолчанию - `true`.
  * `ignoreSystemCrashHandler` Boolean (по желанию) - Если это правда, , генерируемые в основном процессе, не будут перенаправлены обработчику сбоя системы. По умолчанию - `false`.
  * `rateLimit` Boolean ( _)_ _MacOS_ Windows - Если это правда, количество сномов, загруженных до 1/hour. По умолчанию - `false`.
  * `compress` Boolean (по желанию) - Если это правда, отчеты о сбоях будут и загружены `Content-Encoding: gzip`. По умолчанию - `true`.
  * `extra` Запись<String, String> (необязательно) - Дополнительные строки ключ / значение аннотации, которые будут отправлены вместе с отчетами о сбоях, которые генерируются в основном процессе. Поддерживаются только значения строк. Аварии, генерируемые в детских процессах, не будут содержать эти дополнительные параметры к отчетам о сбоях, генерируемым из детских процессов, [`addExtraParameter`](#crashreporteraddextraparameterkey-value) из процесса.
  * `globalExtra` Запись<String, String> (необязательно) - Дополнительные строки ключ / значение аннотации, которые будут отправлены вместе с любыми отчетами о сбоях, генерируемых в любом процессе. Эти аннотации не могут быть изменены после того, как репортер был запущен. Если ключ присутствует как в глобальных дополнительных параметрах, так в процессах дополнительных параметров, то глобальный будет иметь приоритет. По умолчанию `productName` и версия приложения включены, как , так и версия Electron.

Этот метод должен быть вызван перед использованием любых других `crashReporter` API. После инициализированных таким образом, обработчик краш-панели собирает сома из всех впоследствии созданных процессов. Репортер аварии не может быть отключен после работы.

Этот метод следует назвать как можно раньше в запуске приложения, предпочтительно до `app.on('ready')`. Если репортер аварии не инициализирован в когда создается процесс рендерера, то этот процесс рендерера не контролироваться репортером аварии.

**Примечание:** Вы можете проверить аварии репортер, создавая аварии с помощью `process.crash()`.

**Примечание:** Если вам нужно отправить дополнительные/обновленные параметры `extra` после первого вызова `start` вы можете позвонить `addExtraParameter`.

**Примечание:** , пройденные `extra`, `globalExtra` или установленные `addExtraParameter` , имеют ограничения по длине ключей и значений. Ключевые имена должны быть не более 39 байтов в длину, а значения должны быть не более 127 байтов. Ключи с именами длиннее максимума будут молча проигнорированы. Ключевые значения , чем максимальная длина будет усечена.

**Примечание:** Этот метод доступен только в основном процессе.

### `crashReporter.getLastCrashReport()`

Возвращает [`CrashReport`](structures/crash-report.md) - Дата и удостоверение личности последнего аварии. Только сообщения о сбоях, которые были загружены, будут возвращены; даже если отчет о сном присутствует на диске, он не будет возвращен до тех пор, пока загружен. Если нет загруженных отчетов, возвращается `null`.

**Примечание:** Этот метод доступен только в основном процессе.

### `crashReporter.getUploadedReports()`

Возвращает [`CrashReport[]`](structures/crash-report.md):

Возвращает все загруженные отчеты о сбоях. Каждый отчет содержит дату и загруженный идентификатор.

**Примечание:** Этот метод доступен только в основном процессе.

### `crashReporter.getUploadToServer()`

Возвращает `Boolean` - Должны ли отчеты быть представлены на сервер. Установите метод `start` или `setUploadToServer`.

**Примечание:** Этот метод доступен только в основном процессе.

### `crashReporter.setUploadToServer(uploadToServer)`

* `uploadToServer` Boolean - Следует ли отчеты быть представлены на сервер.

Обычно это контролируется предпочтениями пользователей. Это не имеет никакого эффекта, если вызваны `start` , как это называется.

**Примечание:** Этот метод доступен только в основном процессе.

### `crashReporter.addExtraParameter (ключ, значение)`

* `key` String - Параметр ключ, должен быть не более 39 байтов.
* `value` String - Параметр значение, должно быть не более 127 байтов.

Установите дополнительный параметр, который будет отправлен с отчетом о сбое. Значения, указанные здесь, будут отправлены в дополнение к любым значениям, заданным через `extra` , `start` был вызван.

Параметры, добавленные таким образом (или через `extra` параметр `crashReporter.start`) специфичны для процесса вызова. Добавление дополнительных параметров в основной процесс не приведет к отправке этих параметров вместе с с сбоями от рендерера или других процессов ребенка. Аналогичным образом, добавление параметров в процесс рендерера не приведет к отправке этих параметров с сбоями, которые происходят в других процессах рендерера или в основном процессе.

**Примечание:** Параметры имеют ограничения по длине ключей и значений. Ключевые должны быть не более 39 байтов, а значения должны быть не более 20320 байтами. Ключи с именами длиннее максимума будут молча проигнорированы. Ключевые значения длиннее максимальной длины будут усечены.

**Примечание:** на значениях Linux, которые длиннее 127 байтов, будут накочаны на несколько , каждый из которых имеет длину 127 байтов.  Например, `addExtraParameter('foo', 'a'.repeat(130))` приведет к двум коренастый ключи `foo__1` и `foo__2`, первый будет содержать первые 127 байтов, а второй будет содержать оставшиеся 3 байтов.  На отчета о сбоях вы должны сшить вместе ключи в этом формате.

### `crashReporter.removeЭкстраПараметр (ключ)`

* `key` String - Параметр ключ, должен быть не более 39 байтов.

Удалите дополнительный параметр из текущего набора параметров. Будущие аварии не будут включать этот параметр.

### `crashReporter.getParameters()`

Возвращает `Record<String, String>` - Текущие "лишние" параметры аварии репортера.

## Отчет о нагрузке

Процесс отчетов о сбоях отправит следующие данные в `submitURL` как `multipart/form-data` `POST`:

* `ver` String - Версия Electron.
* `platform` String - например, 'win32'.
* `process_type` String - например, 'renderer'.
* `guid` String - например, '5e1286fc-da97-479e-918b-6bfb0c3d1c72'.
* `_version` String - Версия в `package.json`.
* `_productName` String - Имя продукта в `crashReporter` `options` объекте.
* `prod` String - Название основного продукта. В этом случае Электрон.
* `_companyName` String - Имя компании в `crashReporter` `options` объекте.
* `upload_file_minidump` File - Отчет о сбое в формате `minidump`.
* Все свойства на уровне 1 объекта `extra` в объекте `crashReporter` `options`.
