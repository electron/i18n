# Изоляция контекста

## Что это?

Контекстная Изоляция является функцией, гарантирующей, что как ваши `предварительно загрузить` скрипты, так и внутренняя логика Electron запускаются в отдельном контексте на сайте, который вы загружаете в [`веб-контент`](../api/web-contents.md).  Это важно для целей безопасности, так как это помогает сайту не получить доступ к внутренним приложениям Electron или к мощным API, к которым у вас есть доступ скрипт preload.

Это означает, что в окне `` объект, к которому ваш сценарий preload имеет доступ, на самом деле это объект **отличающийся от** объекта, к которому будет иметь доступ.  Например, если вы установите `window.hello = 'wave'` в вашем сценарии предзагрузки, а контекстная изоляция включена `окно. Здравствуйте,` не будет определен, если сайт пытается получить к нему доступ.

Каждое приложение должно иметь включенную интеграцию контекста, а от Electron 12 оно будет включено по умолчанию.

## Как включить это?

От Electron 12 он будет включен по умолчанию. Для более низких версий это опция `веб-настроек` при построении `нового браузерного окна`'s.

```javascript
const mainWindow = new BrowserWindow({
  webPreferences: {
    contextIsolation: true
  }
})
```

## Миграция

> Я использовал API из моего сценария предварительной загрузки с помощью `window.X = apiObject` теперь что?

Распространение API от вашего скрипта до загруженного сайта - это обычная утилита. В Electron есть отдельный модуль, который поможет вам сделать это безболезненно.

**До: Без изоляции контекста отключена**

```javascript
window.myAPI = {
  doAThing: () => {}
}
```

**После: При включенной изоляции контекста**

```javascript
const { contextBridge } = require('electron')

contextBridge.exposeInMainWorld('myAPI , {
  doAThing: () => {}
})
```

Модуль [`contextBridge`](../api/context-bridge.md) может использоваться для **безопасно** выявлять API из изолированного контекста, который запускается в контексте, в котором работает веб-сайт. API также будет доступен с веб-сайта на `window.myAPI` так же, как и раньше.

Вам следует прочитать документацию `contextBridge` выше, чтобы в полной мере понять ее ограничения.  Например, вы не можете отправлять пользовательские прототипы или символы через мост.

## Особенности безопасности

Просто включите [ `] contextIsolation` и использование `contextBridge` не означает, что все, что вы делаете, безопасно.  Для примера этот код **небезопасный**.

```javascript
// ❌ Плохой код
contextBridge.exposeInMainWorld('myAPI, {
  send: ipcRenderer.send
})
```

Он прямо раскрывает мощный API без всякого рода аргументов фильтрации. Это позволит любому сайту отправлять произвольные сообщения IPC, которые вы не хотите видеть. Вместо этого правильным способом выявления API, основанных на IPC, будет предоставление одного метода для каждого сообщения IPC.

```javascript
// ✅ Хороший код
contextBridge.exposeInMainWorld('myAPI', {
  loadPreferences: () => ipcRenderer.invoke('load-prefs')
})
```
