# Ізоляція контексту

## Що це?

Контекстна ізоляція - це функція, яка дозволяє використовувати скрипти `передзавантаження` і внутрішньою логікою Electron в окремому контексті сайту, який ви завантажуєте на [`webContents`](../api/web-contents.md).  Це важливо для цілей безпеки, оскільки це допомагає веб-сайті отримувати доступ до інтерфейсів Electron або мати доступ до потужного API-сценарію з переднавантаженнями доступ до сайту.

Це означає, що об’єкт `вікно` в якому є доступ до сценарію передзавантаження є насправді **іншим** об'єктом, ніж на веб-сайті буде до них.  Наприклад, якщо ви встановили `window.hello = 'wav'` у вашому скрипті завантаження і контекстна ізоляція увімкнена `вікно. Привіт,` не буде визначено, якщо сайт намагається отримати до нього доступ.

Кожен додаток повинен мати увімкнений контекстну ізоляцію, а з Electron 12 буде увімкнено за замовчуванням.

## Як мені це ввімкнути?

З Electron 12, він буде включений за замовчуванням. Для більш детальних версій це опція в `налаштування` при створенні `нового вікна`.

```javascript
const mainWindow = new BrowserWindow({
  webPreferences: {
    contextIsolation: true
  }
})
```

## Міграція

> Я раніше використовував API з мого сценарію завантаження з `вікна.X = apiObject` тепер що?

Виявлення API-інтерфейсу з вашого сценарію для завантаження на завантажений сайт -- це загальна версія usecase і є виділений модуль в Electron для допомоги вам зробити це безболісним чином.

**Кращий результат: з вимкненим контекстом**

```javascript
window.myAPI = {
  doAThing: () => {}
}
```

**Потім: з контекстною ізоляцією увімкнено**

```javascript
const { contextBridge } = require('electron')

contextBridge.exposeInMainWorld('myAPI', {
  doAThing: () => {}
})
```

Модуль [`contextBridge`](../api/context-bridge.md) може бути використаний в **безпечно** видавати API від ізольованого контексту виконання вашого презавантаження скрипту до контексту, в якому працює сайт. API також буде доступний з веб-сайту `window.myAPI` , як і раніше.

Вам слід прочитати документацію `contextBridge` вище, щоб повністю зрозуміти його обмеження.  Наприклад, ви не можете надіслати свої прототипи або символи через міст.

## Застереження щодо безпеки

Просто увімкнути `contextIsolation` і використати `contextBridge` не означає автоматично, що все, що ви робите, є в безпеці.  Наприклад, цей код **небезпечний**.

```javascript
// ❌ Неправильний код
contextBridge.exposeInMainWorld('myAPI', {
  send: ipcRenderer.send
}
```

Це безпосередньо викриває потужний API без будь-якого типу фільтрації аргументів. Це дозволить будь-якому сайті відправити довільні IPC, які ви не хочете робити. Натомість правильним способом викриття API-API було б забезпечити один метод для кожного повідомлення.

```javascript
// ✅ Хороший код
contextBridge.exposeInMainWorld('myAPI', {
  Налаштування: () => ipcRenderer.invoke('load-prefs')
})
```
